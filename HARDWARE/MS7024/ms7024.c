//本文件为RGB转CVBS的转换芯片MS7024的驱动程序，定义了一个配置参数结构体MS7024_8BI8BV_T，以及一个配置函数MS7024_WriteBytes()
#include "ms7024.h"
#include "delay.h"

//参数配置的内容
//change by mch 20180528
//MS7024_8BI8BV_T ms7024_config[]=
//{	
//	  0x04, 0x18,
//    0x05, 0x07,
//    0x06, 0x0f,
//    0x0e, 0x16,
//    0x30, 0x02,
//    0x31, 0x01,//4a
//    0x32, 0x03,
//    0x33, 0x26,//7a hblank start pixel 
//    0x35, 0xfd,//07 Vblank odd start pixel 
//    0x36, 0x01,//02 Vblank odd start pixel 
//    0x37, 0x27,
//    0xa9, 0x47,
//    0xaa, 0x02,
//    0xab, 0x1d,
//    0xad, 0x89,
//    0x50, 0x10,
//    0x51, 0x11,
//    0x52, 0x0b,
//    0x53, 0x01,
//    0x20, 0x59,
//    0x21, 0x08,
//    0x22, 0x63,
//    0x23, 0x01,
//    0x27, 0xc1,
//    0x28, 0xc1,
//    0x60, 0x01,//03
//    0x5f, 0x01,
//    0x2e, 0x11,
//    0xff, 0xff,//结束标志
//};

//MS7024参数更新配置
MS7024_8BI8BV_T ms7024_config_1[]=
{
		0x04, 0x1a,
    0x0e, 0x16,
    0x0f, 0x00,
    0x30, 0x02,
    0x31, 0x01,//4a
    0x32, 0x03,
    0x33, 0x26,//7a
    0x34, 0x00,
    0x35, 0xfd,//07
    0x36, 0x01,//02
    0x37, 0x27,
    0x38, 0x00,
    0x39, 0x00,
    0x3a, 0x00,
    0x3b, 0x00,
    0x3c, 0x00,
    0x90, 0x02,
    0x91, 0x00,
    0x92, 0x00,
    0x93, 0x00,
    0x94, 0x00,
    0x95, 0x00,
    0x96, 0x00,
    0x97, 0x00,
    0x98, 0x00,
    0x99, 0x00,
    0x9a, 0x00,
    0x9b, 0x00,
    0x9c, 0x00,
    0x9d, 0x00,
    0x9e, 0x00,
    0x9d, 0x00,
    0x9e, 0x00,
    0x9f, 0x00,
    0xa0, 0x00,
    0xa1, 0x00,
    0xa2, 0x00,
    0xa4, 0x00,
    0xa5, 0x00,
    0xa6, 0x00,
    0xa7, 0x00,
    0xa8, 0x00,
    0xa9, 0x47,
    0xaa, 0x02,
    0xab, 0x1d,
    0xac, 0x15,
    0xad, 0x89,
    0x50, 0x10,
    0x51, 0x11,
    0x52, 0x0b,
    0x53, 0x01,
    0x54, 0x00,
    0x55, 0x00,
    0x56, 0x00,
    0x57, 0x00,
    0x58, 0x00,
    0x59, 0x00,
    0x5a, 0x00,
    0x20, 0x59,
    0x21, 0x08,
    0x22, 0x63,
    0x23, 0x01,
    0x24, 0x00,
    0x25, 0x00,
    0x26, 0x00,
    0x27, 0xc1,
    0x28, 0xc1,
    0x29, 0x80,
    0x2a, 0x84,
    0x2b, 0x00,
    0x2c, 0x00,
    0x2d, 0x00,
    0x60, 0x0b,
    0x61, 0x00,
    0x62, 0x01,
    0x63, 0x00,
    0x64, 0x20,
    0x66, 0x00,
    0x67, 0x40,
    0x68, 0x00,
    0x69, 0x20,
    0x6a, 0x40,
    0x6b, 0x60,
    0x6c, 0x80,
    0x6d, 0xa0,
    0x6e, 0xc0,
    0x6f, 0xe0,
    0x70, 0xff,
    0x71, 0x03,
    0x72, 0x4b,
    0x73, 0x40,
    0x74, 0x40,
    0x75, 0x40,
    0x76, 0x40,
    0x77, 0x5b,
    0x78, 0x5b,
    0x79, 0x5b,
    0x7a, 0x5b,
    0x7b, 0x02,
    0x7c, 0x8c,
    0x7d, 0xd4,
    0x7e, 0x72,
    0x7f, 0x00,
    0x80, 0x00,
    0x81, 0x00,
    0x82, 0x04,
    0x83, 0x00,
    0x84, 0xff,
    0x85, 0xce,
    0x86, 0xb2,
    0x87, 0x00,
    0x88, 0x00,
    0x89, 0x93,
    0x8a, 0x06,
    0x5f, 0x01,
    0x2e, 0x10,
    0x20, 0x56,
    0x2e, 0x11,
    0x20, 0x50,
		0xff, 0xff,//结束标志
};

MS7024_8BI8BV_T ms7024_config_2[]=
{
		0x20, 0x59,
		0xff, 0xff,//结束标志
};

MS7024_8BI8BV_T ms7024_config_3[]=
{
		0x20, 0x56,
		0x20, 0x50,
		0xff, 0xff,//结束标志
};

MS7024_8BI8BV_T ms7024_config_4[]=
{
		0x20, 0x59,
		0xff, 0xff,//结束标志
};

MS7024_8BI8BV_T ms7024_config_5[]=
{
		0x05, 0x07,
		0x06, 0x0f,
		0xff, 0xff,//结束标志
};

//参数配置函数
void MS7024_WriteBytes(MS7024_8BI8BV_T *pbulkdata)
{
  u8 index;
  u8 value;
  while(1)
  {
    index = pbulkdata -> u8_index;
    value = pbulkdata -> u8_val;
    if(index ==0xff && value == 0xff)
      break;
    MS7024_WriteOneByte(index,value);
    pbulkdata ++;
  }
}

void MS7024_WriteOneByte(u16 WriteAddr,u8 DataToWrite)
{				   	  	    																 
  IIC_Start();  
	//if(EE_TYPE>AT24C16)
	{
		IIC_Send_Byte(0xec);	    //发送写命令
		IIC_Wait_Ack();
		//IIC_Send_Byte(WriteAddr>>8);//发送高地址	  
	}//else IIC_Send_Byte(0XA0+((WriteAddr/256)<<1));   //发送器件地址0XA0,写数据 	 
	//IIC_Wait_Ack();	   
  IIC_Send_Byte(WriteAddr);   //发送低地址
	IIC_Wait_Ack(); 	 										  		   
	IIC_Send_Byte(DataToWrite);     //发送字节							   
	IIC_Wait_Ack();  		    	   
  IIC_Stop();//产生一个停止条件 
	delay_ms(10);	 
}
